# AWS CodePipeline 으로 서버 배포 자동화

## 1. 배경 &#x20;

기존의 서버 배포 프로세스는 jar 파일을 서버에 직접 업로드하여 어플리케이션을 명령어로 직접 실행시키는 방법으로 이루어졌다. &#x20;

## 2. 문제정의&#x20;

위의 방법처럼 수동 배포를 진행할 경우, 아래와 같은 문제점들이 있다.&#x20;

* 배포과정이 매우 귀찮다.&#x20;
* 배포 시간이 오래 걸린다.&#x20;
* 배포 과정이 귀찮기 때문에 소스코드를 최신화하는 주기가 길어지게 된다.&#x20;
* 어플리케이션이 중단되는 시점이 존재한다.&#x20;
* 개발자가 실수할 수 있는 확률이 높아진다.&#x20;
* 배포 버전에 대한 관리가 안된다.&#x20;

## 3. 해결방법

이러한 문제점들을 해결하기 위해서, 서버 배포를 자동화하기로 했다.&#x20;

### 3-1. 왜 AWS Pipeline 인가&#x20;

* 소규모 스타트업의 개발팀인 우리는 개발부터 운영에 드는 비용을 최소화해야한다. 따라서 여러 플랫폼에 걸쳐서 서비스를 이용하기 보다는 웬만하면 기존에 많은 서비스를 사용하고 있는 AWS 에서 제공하는 기능을 이용하기로 했다.&#x20;

### 3-2. 진행순서&#x20;

<figure><img src="../../.gitbook/assets/image (3).png" alt=""><figcaption></figcaption></figure>

현재 우리팀은 소스코드 형상관리 툴로 Bitbucket을, 서버로는 AWS EC2 서비스를 쓰고 있다. AWS Pipeline 에서는 단계별로 사용하고 있는 외부/내부 서비스와 연결하여 배포까지 하나의 파이프 라인을 만들 수 있다. 우리 팀은 아래와 같이 파이프라인을 구성하였다.&#x20;

1. 소스 스테이지
   1. Bitbucket 의 특정 repository 와 연결
   2. 특정 branch 에 push 이벤트 발생하면 자동실행되도록 설정
2. 빌드 스테이지&#x20;
   1. 소스 스테이지에서 가져온 소스코드를 빌드하여 S3에 build artifact 로 저장
3. 배포 스테이지&#x20;
   1. 빌드 스테이지에서 빌드한 artifact 를 가져와 EC2에 배포
   2. EC2 배포 이벤트 실행 직후 어플리케이션 실행&#x20;
   3. Health Check 스크립트로 배포 후 서버 상태 확인&#x20;

### 3-3. 세부 구축과정&#x20;

세부 사항별 구축 과정은 아래의 포스팅을 참고

* [AWS CodePipeline 으로 배포 자동화하기 (1)](../../infrastructure/aws/aws-codepipeline-01.md)
* [AWS CodePipeline 으로 배포 자동화하기 (2)](../../infrastructure/aws/aws-codepipeline-02.md)

## 4. 나의 역할&#x20;

* 전체적으로 10분이상 걸리던 서버 배포 루틴을 자동화하여 최대 3분안에 배포가 완료될 수 있도록 하였다.&#x20;
* 개발자가 직접 서버에 접근하여 배포하던 방식을 자동화하여 사람의 실수로 서버가 불안정해질 확률을 줄였다.&#x20;
* 어플리케이션이 중단되는 시간을 최소한으로 줄였다.&#x20;
* 클릭 한 번으로 배포가 될 수 있도록 했기 때문에 개발 환경에서도항상 최신코드가 업데이트될 수 있도록 하였다.
* 배포 버전에 대한 관리를 시작하였다.&#x20;

## 5. 성과&#x20;

* 실제로 서버 배포 시간 및 어플리케이션 중단 시간이 이전에 비해 대폭 줄어들어 배포 상황에서도 서비스가 이전보다 안정적이게 되었다.&#x20;
* 배포에 드는 노동을 자동화하여, 그 시간에 다른 일을 할 수 있게 되었다.&#x20;
* 배포 버전에 대한 관리가 시작되어 이슈 추적이나 배포 계획을 세우기도 용이해졌다.&#x20;

## 6. 느낀점 / 배운점&#x20;

* 두 번이상 반복되는 행위는 무조건 자동화하는 것이 좋다는 말을 들은 적이 있다. 서비스를 런칭한 뒤, 배포 자동화에 대한 부분을 바로 진행하지 않았던 점이 후회되었다. 당시에는 서비스가 불안정하였기 때문에 서비스를 안정화하고, 최대한 기능 개발을 빠르게 하여 서비스를 성장시키는 것이 최우선이었기 때문에, 막상 개발자로서 내가 일하는 환경을 자동화하는 것은 우선순위가 낮았던 것 같다. 오히려 그때부터 조금씩 반복되는 일들을 자동화하는 노력을 했다면, 개발을 더 빠르게 효율적으로 할 수 있지 않았을까.&#x20;

