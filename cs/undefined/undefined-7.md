# 싱글톤 패턴

1. 가장 기본적인 구현방법&#x20;
2. 문제점
   1. 멀티스레드 환경에서 안전하지 않다. 싱글톤 패턴이지만 두 개의 인스턴스가 만들어질 가능성이 있다.&#x20;
3. 쓰레드 세이프하게 구현하는 방법&#x20;
   1. synchronized 키워드 사용하기&#x20;
      1. 매소드를 아예 락하는 방법이라서 성능상 불이익 발생&#x20;
   2. 이른 초기화 eager initialization 사용하기&#x20;
      1. 미리 static 변수로 선언해서 서버시작시에 아예 만들어두는것
      2. 그러면 아예 호출될때에는 미리 만들어진 것으로부터 사용하게 된다.&#x20;
      3. 단점 - 필요없는 객체를 미리 만들어둔 셈이 될 수 있다.&#x20;
   3. double checked locking 사용하기&#x20;
      1. 사용 전 두번 체크하여 인스턴스 생성한다.&#x20;
      2. volatile - java 1.4 이전에 멀티쓰레드 환경에서 메모리를 다루는 방법을 이해해야한다.&#x20;
      3. 객체가 이미 없는 경우에만, synchronized lock 이 걸리게 되기 때문에 효율적이게 된다.&#x20;
   4. static inner class 만들기&#x20;
      1. private static class Holder{}&#x20;
4. 싱글톤 깨기&#x20;
   1. 리플렉션 사용하기&#x20;
   2. 직렬화와 역직렬화&#x20;
      1. 대응방안 - readResolve()&#x20;
5. enum class 로 구현하기&#x20;
   1. 다른 방법으로는 reflection 은 막을 방법이 없다.&#x20;
   2. enum class - 매우 간단하고 안전하게 싱글톤 구현이 가능하다.&#x20;
   3. 리플렉션으로도 뚫을 수 없는 안전한 코드가 된다.
   4. new instance() 할 수 없도록 막아두었다.&#x20;
   5. 단점
      1. 미리 만들어진다는 점. 클래스를 로딩하는 순간 만들어진다.&#x20;
      2. 상속을 쓰지 못한다.&#x20;
6. 권장패턴&#x20;
   1. holder static inner class
   2. enum class&#x20;
7. java example
   1. Runtime&#x20;
      1. maxMemory
      2. freeMemory
8. spring example&#x20;
   1. ApplicationContext 내부에서 유일한 인스턴스&#x20;
   2. 스프링에서는 싱글톤 스콥 빈으로 등록해서 사용한다.
   3. 빈 스코프 중에 하나로 싱글톤 스코프&#x20;
9. 다른 디자인 패턴&#x20;
   1. 빌더, 퍼사드, 추상펙토리 등의 구현체 일부로 사용되기도 한다. &#x20;

