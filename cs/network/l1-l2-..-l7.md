# 네트워크를 이루는 장치 (L1, L2 .. L7)

## 1. 개념&#x20;

* 네트워크는 여러 개의 네트워크를 기반으로 구축된다.&#x20;
* 네트워크의 기기는 계층별로 처리 범위를 나눌 수가 있다.&#x20;
* 상위 계층을 처리하는 기기는 하위 계층을 처리할 수 있지만, 그 반대는 불가하다.&#x20;
  * 어플리케이션 계층의 L7 스위치는 그 하위의 모든 프로토콜을 처리할 수 있지만,&#x20;
  * 물리계층의 AP는 물리계층밖에 처리하지 못한다.&#x20;

## 2. 종류&#x20;

1. Application : L7 스위치&#x20;
2. Transport : L4 스위치&#x20;
3. Internet/Network : L3 스위치, 라우터&#x20;
4. NetworkAccess/Link&#x20;
   1. Data Link : L2 스위치, 브리지&#x20;
   2. Physical : NIC, 리피터, AP&#x20;

<figure><img src="../../.gitbook/assets/image (1) (1) (3) (4).png" alt=""><figcaption><p><a href="https://microchipdeveloper.com/tcpip:tcp-ip-five-layer-model">https://microchipdeveloper.com/tcpip:tcp-ip-five-layer-model</a></p></figcaption></figure>

<figure><img src="../../.gitbook/assets/image (5) (10).png" alt=""><figcaption><p><a href="https://velog.io/@wldus9503/%EB%84%A4%ED%8A%B8%EC%9B%8C%ED%81%ACTCP">https://velog.io/@wldus9503/네트워크TCP</a></p></figcaption></figure>

## 3. Application Layer

### 3-1. L7 switch (OSI Layer 7)&#x20;

* &#x20;여러 장비를 연결하고, 데이터 통신을 중재하며 목적지가 연결된 포트로만 전기신호를 보내 데이터를 전송하는 통신 네트워크 장비
* 로드 밸런서라고도 하며 서버의 부하를 분산하는 기기이다. 서버 이중화, 보안에 강점이 있다.&#x20;
  * 클라이언트로부터 오는 요청을 뒤쪽의 여러대이 서버로 나누는 역할을 하고, 시스템이 처리할 수 있는 트래픽 증가를 목표로 한다.&#x20;
* URL, 서버, 캐시, 쿠키 등을 기반으로 트래픽을 분산한다.&#x20;
* 바이러스, 불필요한 외부 데이터를 걸러내는 필터링 기능 존재
* 응용 프로그램 수준의 트래픽 모니터링도 가능하다.&#x20;
* 장애 발생시, 트래픽 분산 대상에서 제외해야하므로, 정기적으로 서버에 대한 헬스체크를 진행한다.&#x20;
* 헬스체크&#x20;
  * L4 스위치, L7 스위치 모두 로드 밸런서 기능을 하고, 헬스 체크를 통해 정상적인 서버인지 판별한다.&#x20;
  * 헬스 체크는 전송 주기와 재전송 횟수를 미리 설정하여 서버에 반복적으로 요청을 보내는 것을 의미한다.
    * 예를 들어서 TCP 요청을 보냈는데 3way handshake 가 일어나지 않으면 정상이 아닌 것으로 판단한다.  &#x20;

### 3-2. 서버 이중화&#x20;

* 로드밸런서의 대표적인 기능인 서버 이중화&#x20;
* 서비스를 안정적으로 운용하기 위해서 서버 2대 이상은 필수적이다. 에러가 발생하여 서버 1대가 종료되더라도, 서비스는 안정적으로 운용되어야 하기 때문이다.&#x20;
* 로드 밸런서가 제공하는 가상의 IP에 클라이언트가 접근하는데, 뒤쪽의 서버가 장애가 나면 그 서버는 트래픽 분산 대상에서 제외하고, 다른 서버로만 트래픽을 이동시켜 안정적으로 운용할 수 있도록 한다.&#x20;
* 가상 IP 를 제공하여 실제 IP 가 노출되지 않기 떄문에 클라이언트가 호스트에 직접 접근하지 않고 상호작용하는 것을 막을 수 있어서  보안적으로 좋고, 안정적이다.&#x20;

### 3-3. 참고&#x20;

클라우드 서비스 AWS 에서 찾을 때,&#x20;

* L7 스위치를 이용한 로드밸런식은 ALB - Application Load Balancer 컴포넌트로 하고&#x20;
* L4 스위치를 이용한 로드 밸런서는 NLB - Network Load Balancer 로 한다.&#x20;

## 4. Transport Layer&#x20;

### 4-1. L4 Switch&#x20;

1. 로드밸런서로서 부하분산 기능을 가진다.&#x20;
2. 상위 계층의 패킷을 분석하여 트래픽의 우선순위를 부여한다.&#x20;
   1. http -> 80&#x20;
   2. https -> 443&#x20;
3. 헤더를 분석해서 부하분산을 할 수 있다.&#x20;

## 5. Internet/Network Layer

### 5-1. 라우터&#x20;

* 라우팅을 하는 장비&#x20;
* 라우팅 : 하나 이상의 네트워크에서 경로를 선택하는 프로세스&#x20;
* 다른 네트워크에 존재하는 장치끼리 서로 데이터를 주고 받을 때, 패킷 손실을 최소화하고, 경로를 최적화하는 장비이다.&#x20;

### 5-2. L3 Switch&#x20;

* 하드웨어 기반의 라우팅을 담당하는 것을 L3 스위치라고 한다.&#x20;
* 라우터는 소프트웨어 기반의 라우팅과, 하드웨어 기반의 라우팅이 존재한다.&#x20;

## 6. Data-Link Layer

### 6-1. Link layer&#x20;

TCP/IP 4계층에서 최하위의 링크 계층은 전선, 광섬유, 무선 등으로 실질적으로 데이터를 전달하여 장치간에 신호를 주고 받는 규칙을 정하는 계층이다. 네트워크 접근 계층이라고도 한다.&#x20;

OSI 7 계층에서는 이 계층이 두 가지로 나뉘게 되는데, 그것이 바로 Data-link layer 와 physical layer 이다.&#x20;

* data-link layer : 이더넷 프레임을 통해서 에러확인, 흐름제어, 접근제어를 담당하는 계층을 말한다.&#x20;
* physical layer : 무선 LAN 과 유선 LAN 을 통해서 0과 1로 이루어진 데이터를 보내는 계층을 말한다.&#x20;

### 6-2. L2 switch&#x20;

* MAC 주소를 MAC 주소 테이블을 통해서 관리하며,&#x20;
* 연결된 장치로부터 패킷이 왔을 때, 패킷 전송을 담당한다.&#x20;
* IP 주소를 이해하지 못하기 떄문에 IP 주소를 기반으로 라우팅이 불가하다.&#x20;
* 단순히 패킷의 MAC 주소를 읽어서 스위칭하는 역할을 한다.&#x20;
* 목적지가 MAC 주소 테이블에 없다면, 전체 포트에 전달하고, MAC 주소 테이블의 주소는 일정 시간 이후 삭제하는 기능도 있다.&#x20;
* L3 스위치와 비교&#x20;
  * 참조 테이블 : L2는 MAC 주소 테이블을 참고, L3 는 라우팅 테이블을 참고&#x20;
  * 참조 PDU :  L2는 이더넷 프레임을 참고, L3 는 IP 패킷을 참고
  * 참조 주소 : L2는 MAC 주소를 참고, L3 는 IP 주소를 참고

### 6-3. Bridge&#x20;

* 브리지는 두 개의 근거리 통신망 LAN 을 상호 접속할 수 있도록 하는 통신망 연결 장치로, 포트와 포트 사이의 다리 역할을 한다.&#x20;
* 장치에서 받아온 MAC 주소를 MAC 주소 테이블로 관리를 한다.&#x20;
* 브리지는 통신망의 범위를 확장하고, 서로 다른 LAN 등으로 이루어진 하나의 통신망을 구축할 때 쓰인다.&#x20;

### 6-4. 이더넷 프레임&#x20;

<figure><img src="../../.gitbook/assets/image (2) (1) (1).png" alt=""><figcaption><p><a href="https://mintnlatte.tistory.com/356">https://mintnlatte.tistory.com/356</a></p></figcaption></figure>

* 데이터링크 계층은 이더넷 프레임을 통해서 전달받은 데이터의 에러를 검출하고, 캡슐화한다.&#x20;
* Preamble : 이더넷 프레임의 시작&#x20;
* SFD : 다음 바이트부터 MAC 주소 필드가 시작됨을 알림&#x20;
* DMAC, SMAC : Destination MAC, Source MAC address&#x20;
* EtherType : 데이터 계층 위의 계층인 ip protocol 을 정의한다. 예를 들면, IPv4, IPv6.
* Payload : 이전계층으로부터 차곡차곡 전달받은 데이터&#x20;
* CRC : 에러확인을 위한 비트&#x20;

참고로 MAC 주소는&#x20;

* 컴퓨터, 노트북, 스마트폰 등 각 장치에 네트워크에 연결하기 위한 장치인 LAN 카드(NIC) 가 이는데, 이를 구별하기 위한 식별번호를 말한다. 6바이트(48비트)로 구성된다.&#x20;

## 7. Physical Layer&#x20;

### 7-1. NIC&#x20;

* LAN 카드 라고 하는 네트워크 인터페이스 카드는 2대 이상의 컴퓨터 네트워크를 구성하는데 사용한다.&#x20;
* 네트워크와 빠른 속도로 데이터를 송수신 할 수 있도록 컴퓨터 내에 설치하는 확장 카드&#x20;
* 각 LAN 카드에는 주민등록번호처럼 각각을 구분하기 위한 고유의 식별번호인 MAC 주소가 있다.&#x20;

### 7-2. repeater&#x20;

* 들어오는 약해진 신호 정도를 증폭하여 다른 쪽으로 전달하는 장치를 말한다.&#x20;
* 이를 통해서 패킷을 더 멀리 보낼 수 있다.&#x20;
* 광케이블이 보급되면서 요즘에는 거의 쓰이지 않는다.&#x20;

### 7-3. AP, Access Point&#x20;

* 패킷을 복사하는 기계
* AP 에 유선 LAN 을 연결한 후에 다른 장치에서 무선 LAN 기술 (와이파이 등) 을 사용하여 무선 네트워크에 연결을 할 수 있다.&#x20;
* 참고로 물리계층은 유선 LAN 과 무선 LAN으로 나뉘어짐&#x20;
